<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微博热搜</title>
    <!-- 引入 echarts.js -->
    <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
</head>

<body>
    <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
    <div id="main" style="width: 900px;height:400px;"></div>
    <script type="text/javascript">
        // 获取json中元素下标
        //  arr: 传入的数组
        //  obj: 需要获取下标的元素
        function getArrayIndex(arr, obj) {
            var i = arr.length;
            //当i为0时，循环会跳出
            while (i--) {
                if (arr[i] === obj) {
                    return i
                }
            }
            return -1
        }

        //构造变量
        var keyword = new Array(); //热搜
        var searchNum = new Array(); //搜索数
        var link = new Array(); //热搜链接
        var rank = new Array(); //最高排名
        var rankinterval;
        var sNinterval;
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        //请求数据
        var requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };
        fetch("http://pi.deadpoetspoon.xyz:7800/resou/?datacode=lkrst&begintime=2020-01-01&endtime=2020-02-11&num=10", requestOptions)
            .then(response => response.json())
            //.then(result => console.log(result))
            .then(result => {
                result.forEach(rs => {
                    keyword.unshift(rs.keyword);
                    searchNum.unshift(rs.searchNum);
                    link.unshift(rs.link);
                    rank.unshift(rs.rank);
                });
                //console.log(rank[0]);
                sNinterval = searchNum[9] / 5;
                rankinterval = rank[0] / 5;
                myChart.setOption(option);
            })
            .catch(error => console.log('error', error));


        var myColor = ['#ecbbbc', '#e7a7a9', '#e19395', '#db7f81', '#d66b6e', '#d0575a', '#ca4346', '#bf3539',
            '#ab3033', '#972a2d'
        ]
        // 指定图表的配置项和数据
        var option = {
            grid: {
                containLabel: true,
                right:120
            },
            title: {
                text: '时间范围微博热搜排行榜',
                top: 19,
                left:120,

            },
            tooltip: {},
            legend: {
                data: ['热度', '单日最高热搜排名'],
                top: 30,
                left:600,
            },
            yAxis: {
                data: keyword,
                axisPointer: {
                    label: {
                        show: true,
                        margin: 30
                    }
                },
            },
            xAxis: [{
                type: 'value',
                name: '热度',
                min: 0,
                max: searchNum[9],
                interval: sNinterval,
            }, {
                type: 'value',
                name: '单日最高热搜排名',
                min: 0,
                max: rank[0],
                interval: rankinterval,
                minInterval: 1,
            }, ],
            series: [{
                    name: '热度',
                    type: 'bar',
                    data: searchNum,
                    label: {
                        show: true,
                         position: 'insideRight'

                    },
                    itemStyle: {
                        normal: {
                            color: function (params) {
                                return myColor[getArrayIndex(keyword, params.name)]
                            }
                        }
                    }
                },
                {
                    name: '单日最高热搜排名',
                    type: 'line',
                    lineStyle: {
                        color: '#FF8C00',
                        width: 2
                    },
                    symbol: 'circle',
                    symbolSize: 8,
                    xAxisIndex: 1,
                    data: rank,
                    itemStyle: {
                        normal: {
                            color: function (params) {
                                return '#FFD700'
                            }
                        }
                    }
                }
            ]

        };

        // 处理点击事件并且链接到对应的微博
        myChart.on('click', function (params) {
            //所有的鼠标事件包含参数 params，这是一个包含点击图形的数据信息的对象
            // alert(params.value + params.name)//弹窗显示信息
            window.open(link[getArrayIndex(keyword, params.name)])
        });
    </script>
</body>

</html>